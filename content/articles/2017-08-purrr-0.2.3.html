---
title: purrr 0.2.3
slug: purrr-0.2.3
author: Lionel Henry
date: 2018-08-09
photo:
  url: https://unsplash.com/photos/TAN1KpDS7Rg
  author: Erika Lanpher
categories: [Packages]
---



<p>We are pleased to announce that purrr 0.2.3 is now on CRAN! Despite the small increment in the version number (our mistake, it should have been 0.3.0), this is a rather major release that includes many new features and bug fixes.</p>
<p>Install the latest version of purrr with:</p>
<pre class="r"><code>install.packages(&quot;purrr&quot;)</code></pre>
<p>You can read about the complete set of changes at <a href="https://github.com/tidyverse/purrr/releases/tag/v0.2.3" class="uri">https://github.com/tidyverse/purrr/releases/tag/v0.2.3</a>. In this blog post, I will present the highlights of this version which are a family of generic mappers, a new <code>pluck()</code> function for accessing deep elements in a readable way, and a few nifty features and improvements.</p>
<div id="generic-mapping" class="section level3">
<h3>Generic Mapping</h3>
<p>The new <code>modify</code> family of functions introduces genericity to mapping. This means it is now easier to map functions over vector-like S3 objects. The reason is twofold:</p>
<ul>
<li><p><code>map()</code> and friends apply functions on the elements of the underlying data structure but that is not always appropriate. An object sometimes contains metadata. A user of such a class probably wants to map over the <em>elements</em> of the data of interest rather than over the metadata fields.</p></li>
<li><p><code>map()</code> is type-stable and always returns a list. If you’re mapping over an object, chances are you want a similar object back.</p></li>
</ul>
<p><code>modify()</code> and its variants solve both these problems via S3 dispatch.</p>
<p>As a developer there are two ways to make your class compatible with <code>modify()</code> . The easiest is to implement a method for the subset-assign operator <code>[&lt;-</code> which should be sufficient in most cases. Alternatively you can implement methods for the <code>modify</code> functions themselves as they are all generics.</p>
</div>
<div id="pluck" class="section level3">
<h3>pluck()</h3>
<p>The plucking mechanism used for indexing into data structures with <code>map()</code> has been extracted into the function <code>pluck()</code>. Plucking is often more readable to extract an element buried in a deep data structure. Compare this syntax-heavy extraction which reads non-linearly:</p>
<pre class="r"><code>accessor(x[[1]])$foo</code></pre>
<p>to the equivalent pluck:</p>
<pre class="r"><code>x %&gt;% pluck(1, accessor, &quot;foo&quot;)</code></pre>
<p>The new function <code>attr_getter()</code> generates attribute accessors that can be used in <code>pluck()</code>:</p>
<pre class="r"><code>dfs &lt;- list(iris, mtcars)
dfs %&gt;% pluck(2, attr_getter(&quot;row.names&quot;))
#&gt;  [1] &quot;Mazda RX4&quot;           &quot;Mazda RX4 Wag&quot;       &quot;Datsun 710&quot;         
#&gt;  [4] &quot;Hornet 4 Drive&quot;      &quot;Hornet Sportabout&quot;   &quot;Valiant&quot;            
#&gt;  [7] &quot;Duster 360&quot;          &quot;Merc 240D&quot;           &quot;Merc 230&quot;           
#&gt; [10] &quot;Merc 280&quot;            &quot;Merc 280C&quot;           &quot;Merc 450SE&quot;         
#&gt; [13] &quot;Merc 450SL&quot;          &quot;Merc 450SLC&quot;         &quot;Cadillac Fleetwood&quot; 
#&gt; [16] &quot;Lincoln Continental&quot; &quot;Chrysler Imperial&quot;   &quot;Fiat 128&quot;           
#&gt; [19] &quot;Honda Civic&quot;         &quot;Toyota Corolla&quot;      &quot;Toyota Corona&quot;      
#&gt; [22] &quot;Dodge Challenger&quot;    &quot;AMC Javelin&quot;         &quot;Camaro Z28&quot;         
#&gt; [25] &quot;Pontiac Firebird&quot;    &quot;Fiat X1-9&quot;           &quot;Porsche 914-2&quot;      
#&gt; [28] &quot;Lotus Europa&quot;        &quot;Ford Pantera L&quot;      &quot;Ferrari Dino&quot;       
#&gt; [31] &quot;Maserati Bora&quot;       &quot;Volvo 142E&quot;</code></pre>
<p>or in mapped indexing:</p>
<pre class="r"><code>x &lt;- list(
  list(vec = letters, df = mtcars),
  list(vec = LETTERS, df = iris)
)
x %&gt;% map(list(&quot;df&quot;, attr_getter(&quot;row.names&quot;)))
#&gt; [[1]]
#&gt;  [1] &quot;Mazda RX4&quot;           &quot;Mazda RX4 Wag&quot;       &quot;Datsun 710&quot;         
#&gt;  [4] &quot;Hornet 4 Drive&quot;      &quot;Hornet Sportabout&quot;   &quot;Valiant&quot;            
#&gt;  [7] &quot;Duster 360&quot;          &quot;Merc 240D&quot;           &quot;Merc 230&quot;           
#&gt; [10] &quot;Merc 280&quot;            &quot;Merc 280C&quot;           &quot;Merc 450SE&quot;         
#&gt; [13] &quot;Merc 450SL&quot;          &quot;Merc 450SLC&quot;         &quot;Cadillac Fleetwood&quot; 
#&gt; [16] &quot;Lincoln Continental&quot; &quot;Chrysler Imperial&quot;   &quot;Fiat 128&quot;           
#&gt; [19] &quot;Honda Civic&quot;         &quot;Toyota Corolla&quot;      &quot;Toyota Corona&quot;      
#&gt; [22] &quot;Dodge Challenger&quot;    &quot;AMC Javelin&quot;         &quot;Camaro Z28&quot;         
#&gt; [25] &quot;Pontiac Firebird&quot;    &quot;Fiat X1-9&quot;           &quot;Porsche 914-2&quot;      
#&gt; [28] &quot;Lotus Europa&quot;        &quot;Ford Pantera L&quot;      &quot;Ferrari Dino&quot;       
#&gt; [31] &quot;Maserati Bora&quot;       &quot;Volvo 142E&quot;         
#&gt; 
#&gt; [[2]]
#&gt;   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
#&gt;  [18]  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34
#&gt;  [35]  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51
#&gt;  [52]  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68
#&gt;  [69]  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85
#&gt;  [86]  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 102
#&gt; [103] 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119
#&gt; [120] 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136
#&gt; [137] 137 138 139 140 141 142 143 144 145 146 147 148 149 150</code></pre>
</div>
<div id="useful-tweaks-and-features" class="section level3">
<h3>Useful tweaks and features</h3>
<ul>
<li><p><code>set_names()</code> (now reexported from rlang) can now take a function to tranform the names programmatically, and you can supply names in <code>...</code> to reduce typing even more more.</p></li>
<li><p>You can now refer to arguments by position in lambda-formulas. The <code>..1</code> symbol refers to the first argument, <code>..2</code> to the second and so on. This makes it easier to use functions like <code>pmap()</code> with the formula shortcut.</p></li>
<li><p>All typed map functions now treat <code>NULL</code> the same way as an empty vector: they return an empty vector if any input is empty.</p></li>
<li><p><code>auto_browse(f)</code> returns a new function that automatically calls <code>browser()</code> if <code>f</code> throws an error.</p></li>
<li><p><code>vec_depth()</code> computes the depth (i.e. the number of levels of indexing) or a vector.</p></li>
<li><p><code>reduce2()</code> and <code>reduce2_right()</code> make it possible to reduce with a 3 argument function where the first argument is the accumulated value, the second argument is <code>.x</code>, and the third argument is <code>.y</code>.</p></li>
<li><p><code>list_modify()</code> extends <code>stats::modifyList()</code> to replace by position if the list is not named. <code>list_merge()</code> operates similarly to <code>list_modify()</code> but combines instead of replacing.</p></li>
<li><p><code>modify_depth()</code> (previously <code>at_depth()</code>) gains new <code>.ragged</code> argument, and negative depths are now computed relative to the deepest component of the list.</p></li>
</ul>
</div>
<div id="api-changes" class="section level3">
<h3>API Changes</h3>
<p>purrr no longer depends on lazyeval or Rcpp (or dplyr, as of the previous version). This makes the dependency graph of the tidyverse simpler, and makes purrr more suitable as a dependency of lower-level packages.</p>
<p>A number of functions have been renamed or deprecated:</p>
<ul>
<li><p><code>is_numeric()</code> and <code>is_scalar_numeric()</code> are deprecated because they don’t test for what you might expect at first sight.</p></li>
<li><p><code>as_function()</code> is now <code>as_mapper()</code> because it is a tranformation that makes sense primarily for mapping functions, not in general. The rlang package has an <code>as_function()</code> coercer that is smaller in scope.</p></li>
<li><p>The data frame suffix <code>_df</code> has been (soft) deprecated in favour of <code>_dfr</code> to more clearly indicate that it’s a row-bind. All variants now also have a <code>_dfc</code> for column binding. (These will not be terribly useful until <code>dplyr::bind_rows()</code>/<code>dplyr::bind_cols()</code> have better semantics for vectors.)</p></li>
<li><p><code>cross_n()</code> has been renamed to <code>cross()</code>. The <code>_n</code> suffix was removed for consistency with <code>pmap()</code> (originally called <code>map_n()</code> at the start of the project) and <code>transpose()</code> (originally called <code>zip_n()</code>). Similarly, <code>cross_d()</code> has been renamed to <code>cross_df()</code> for consistency with <code>map_df()</code>.</p></li>
<li><p><code>contains()</code> has been renamed to <code>has_element()</code> to avoid conflicts with dplyr.</p></li>
<li><p><code>at_depth()</code> has been renamed to <code>modify_depth()</code>.</p></li>
</ul>
<p>Finally, these functions have been removed from the package:</p>
<ul>
<li><p>The previously deprecated functions <code>flatmap()</code>, <code>map3()</code>, <code>map_n()</code>, <code>walk3()</code>, <code>walk_n()</code>, <code>zip2()</code>, <code>zip3()</code>, <code>zip_n()</code> have been removed.</p></li>
<li><p><code>order_by()</code>, <code>sort_by()</code> and <code>split_by()</code> have been removed. <code>order_by()</code> conflicted with <code>dplyr::order_by()</code> and the complete family doesn’t feel that useful. Use tibbles instead.</p></li>
</ul>
</div>
